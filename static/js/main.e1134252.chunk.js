(this["webpackJsonpcar-rental-system"]=this["webpackJsonpcar-rental-system"]||[]).push([[0],{342:function(e,t,a){e.exports=a(642)},641:function(e,t,a){},642:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(23),i=a.n(o),c=a(203),l=a.n(c),s=a(295),u=a(76),d=a(30),m=a(24),f=a(25),h=a(60),y=a(58),g=a(61),v=a(654),E=a(645),b=a(646),p=a(14),k=a(90),D=a(21),Y=a(296),j=r.a.createContext({}),O=j.Provider,M=j.Consumer,S=a(652),I=a(298),A=a(300),C=a(62),_=function(){var e=Object(n.useState)([]),t=Object(D.a)(e,2),a=t[0],o=t[1],i=Object(n.useRef)(null),c=Object(C.f)(),l=function(e){e.preventDefault(),a&&a.length&&c.push("/show/".concat(a[0].id))};return r.a.createElement(M,null,(function(e){var t=e.vehicles;return r.a.createElement(S.a,{inline:!0,onSubmit:l,className:"mr-md-3"},r.a.createElement(I.a,null,r.a.createElement(Y.Typeahead,{id:"search-vehicle",labelKey:function(e){return"".concat(e.manufacturer," ").concat(e.model," (").concat(e.year,")")},filterBy:["manufacturer","model","year"],options:t,placeholder:"Search for a vehicle...",highlightOnlyResult:!0,minLength:1,onChange:function(e){return o(e)},ref:i}),r.a.createElement(A.a,{variant:"outline-primary",type:"submit",className:"ml-sm-3"},"Search"),r.a.createElement(A.a,{onClick:function(){i.current.clear(),i.current.focus()},variant:"outline-danger",className:"ml-sm-3"},"Clear")))}))},N=function(e){function t(){return Object(m.a)(this,t),Object(h.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){return r.a.createElement(v.a,{bg:"light",variant:"light",expand:"lg"},r.a.createElement(v.a.Brand,{as:p.b,to:"/",className:"mr-lg-5"},"Car Rental System"),r.a.createElement(v.a.Toggle,{"aria-controls":"navbar-collapse"}),r.a.createElement(v.a.Collapse,{id:"navbar-collapse"},r.a.createElement(E.a,{className:"mr-auto"},r.a.createElement(k.a,null,r.a.createElement(E.a.Link,{as:p.b,to:"/",className:"mr-lg-3"},"Home")),r.a.createElement(b.a,{className:"mr-lg-4",title:"Manage vehicles",id:"manage-vehicles"},r.a.createElement(b.a.Item,{as:p.b,to:"/browse"},"Browse vehicles"),r.a.createElement(b.a.Item,{as:p.b,to:"/add"},"Add a new vehicle"))),r.a.createElement(_,null)))}}]),t}(r.a.Component),w=a(649),R=a(650),T=a(299),P=a(647),F=function(){return r.a.createElement(P.a,{animation:"border",variant:"success",role:"status",style:{width:"5rem",height:"5rem"}},r.a.createElement("span",{className:"sr-only"},"Loading..."))},x=a(653),B=function(e){var t=Object(n.useState)(!0),a=Object(D.a)(t,2),o=a[0],i=a[1];return r.a.createElement(x.a,{style:{display:e.display?"block":"none",position:"absolute",top:0,left:"50%",transform:"translateX(-50%)"},onClose:function(){return i(!1)},show:o,delay:3e3,autohide:!0},r.a.createElement(x.a.Header,null,r.a.createElement("strong",{className:"mr-auto"},"Notification")),r.a.createElement(x.a.Body,null,e.message))},L=a(656),V=a(651),J=a(7),q=a.n(J),U=function(){var e=Object(n.useContext)(j),t=e.vehicles,a=e.deleteResource,o=a.resource,i=a.resourceType;return r.a.createElement(M,null,(function(e){var a=e.deleteResource;return r.a.createElement(V.a,{size:"lg",show:a.showDeleteResourceModal,onHide:function(){return a.setDeleteResourceModalShow(null,null)},"aria-labelledby":"delete-modal",centered:!0},r.a.createElement(V.a.Header,{closeButton:!0},r.a.createElement(V.a.Title,{id:"delete-modal"},"Delete confirmation")),r.a.createElement(V.a.Body,null,r.a.createElement("h3",{className:"mb-4"},"Are you sure that you want to delete this ",i," from the system?"),r.a.createElement("h4",null,i," information:")),function(e,a){if(e&&a)switch(e.trim().toLowerCase()){case"vehicle":return r.a.createElement(L.a,null,r.a.createElement(L.a.Item,null,"Manufacturer: ",a?a.manufacturer:""),r.a.createElement(L.a.Item,null,"Model: ",a?a.model:""),r.a.createElement(L.a.Item,null,"Year: ",a?a.year:""),r.a.createElement(L.a.Item,null,"Registration number: ",a?a.registrationNumber:""),r.a.createElement(L.a.Item,null,"Odometer reading: ",a?a.odometerReading:0," km"),r.a.createElement(L.a.Item,null,"Tank capacity: ",a?a.tankCapacity:0," L"));case"journey":return r.a.createElement(L.a,null,r.a.createElement(L.a.Item,null,"Journey vehicle: ",a&&t.find((function(e){return e.bookings.some((function(e){return e.journeys.some((function(e){return e.id===a.id}))}))}))?"".concat(t.find((function(e){return e.bookings.some((function(e){return e.journeys.some((function(e){return e.id===a.id}))}))})).manufacturer," ").concat(t.find((function(e){return e.bookings.some((function(e){return e.journeys.some((function(e){return e.id===a.id}))}))})).model," (").concat(t.find((function(e){return e.bookings.some((function(e){return e.journeys.some((function(e){return e.id===a.id}))}))})).year,")"):""),r.a.createElement(L.a.Item,null,"Journey start date: ",a?q()(a.journeyStartedAt).format("DD/MM/YYYY"):""),r.a.createElement(L.a.Item,null,"Journey end date: ",a?q()(a.journeyEndedAt).format("DD/MM/YYYY"):""),r.a.createElement(L.a.Item,null,"Journey start odometer reading: ",a?"".concat(a.journeyStartOdometerReading," km"):""),r.a.createElement(L.a.Item,null,"Journey end odometer reading: ",a?"".concat(a.journeyEndOdometerReading," km"):""),r.a.createElement(L.a.Item,null,"Journey from: ",a?a.journeyFrom:""),r.a.createElement(L.a.Item,null,"Journey to: ",a?a.journeyTo:""));case"booking":return r.a.createElement(L.a,null,r.a.createElement(L.a.Item,null,"Booking vehicle: ",a?"".concat(t.find((function(e){return e.id===a.vehicleID})).manufacturer," ").concat(t.find((function(e){return e.id===a.vehicleID})).model," (").concat(t.find((function(e){return e.id===a.vehicleID})).year,")"):""),r.a.createElement(L.a.Item,null,"Booking start date: ",a?q()(a.startDate).format("DD/MM/YYYY"):""),r.a.createElement(L.a.Item,null,"Booking end date: ",a?q()(a.endDate).format("DD/MM/YYYY"):""),r.a.createElement(L.a.Item,null,"Booking start odometer reading: ",a?"".concat(a.startOdometer," km"):""),r.a.createElement(L.a.Item,null,"Booking type: ",a?"K"===a.bookingType?"Per kilometer":"Per day":""),r.a.createElement(L.a.Item,null,"Booking cost: ","$ ".concat(Number.parseFloat(a.bookingCost).toFixed(2))));case"service":return r.a.createElement(L.a,null,r.a.createElement(L.a.Item,null,"Service vehicle: ",a&&t.some((function(e){return e.id===a.vehicleID}))?"".concat(t.find((function(e){return e.id===a.vehicleID})).manufacturer," ").concat(t.find((function(e){return e.id===a.vehicleID})).model," (").concat(t.find((function(e){return e.id===a.vehicleID})).year,")"):""),r.a.createElement(L.a.Item,null,"Serviced at: ",a?q()(a.servicedAt).format("DD/MM/YYYY"):""),r.a.createElement(L.a.Item,null,"Service odometer reading: ",a?"".concat(a.serviceOdometer," km"):""));case"fuelpurchase":case"fuel purchase":return r.a.createElement(L.a,null,r.a.createElement(L.a.Item,null,"Fuel purchased for vehicle: ",a&&t.find((function(e){return e.bookings.some((function(e){return e.fuelPurchases.some((function(e){return e.id===a.id}))}))}))?"".concat(t.find((function(e){return e.bookings.some((function(e){return e.fuelPurchases.some((function(e){return e.id===a.id}))}))})).manufacturer," ").concat(t.find((function(e){return e.bookings.some((function(e){return e.fuelPurchases.some((function(e){return e.id===a.id}))}))})).model," (").concat(t.find((function(e){return e.bookings.some((function(e){return e.fuelPurchases.some((function(e){return e.id===a.id}))}))})).year,")"):""),r.a.createElement(L.a.Item,null,"Fuel quantity: ",a?"".concat(a.fuelQuantity," L"):""),r.a.createElement(L.a.Item,null,"Fuel price: ",a?"$ ".concat(Number.parseFloat(a.fuelPrice).toFixed(2)):""),r.a.createElement(L.a.Item,null,"Total cost: ",a?"$ ".concat((a.fuelQuantity*a.fuelPrice).toFixed(2)):""));default:return r.a.createElement("p",{className:"text-center"},"Error: resource info not found")}}(i,o),r.a.createElement(V.a.Footer,null,r.a.createElement(A.a,{variant:"danger",size:"lg",className:"mr-3",onClick:function(){return a.resource?a.confirmDeleteResource(i,o):""}},"Delete"),r.a.createElement(A.a,{variant:"info",size:"lg",onClick:function(){return a.setDeleteResourceModalShow(null)}},"Cancel")))}))},H=a(655),K=a(657),z=a(648),G=a(38),Q=a(65),$=a(28),W=function(e){var t=e.vehicle,a=t.bookings,o=t.services,i=Object(n.useContext)(j).deleteResource;return r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,null,r.a.createElement(K.a,{style:{overflow:"visible"}},r.a.createElement(K.a.Header,null,r.a.createElement(H.a.Toggle,{className:"mr-auto",as:A.a,variant:"link",eventKey:"".concat(t.manufacturer," ").concat(t.model," (").concat(t.year,")")},"".concat(t.manufacturer," ").concat(t.model," (").concat(t.year,")")),r.a.createElement(z.a,{"aria-label":"Options"},r.a.createElement(p.b,{to:"/edit/".concat(t.id),className:"mr-3"},r.a.createElement(A.a,{variant:"outline-warning"},r.a.createElement(G.a,{icon:Q.b}))),r.a.createElement(A.a,{onClick:function(){return i.setDeleteResourceModalShow("vehicle",t)},className:"mr-3",variant:"outline-danger"},r.a.createElement(G.a,{icon:Q.c})),r.a.createElement($.a,{drop:"right"},r.a.createElement($.a.Toggle,{variant:"outline-secondary"},r.a.createElement(G.a,{icon:Q.a})),r.a.createElement($.a.Menu,null,r.a.createElement($.a.Item,{as:p.b,to:"/addService/".concat(t.id)},"Add service"),r.a.createElement($.a.Item,{as:p.b,to:"/addBooking/".concat(t.id)},"Add booking"),r.a.createElement($.a.Item,{as:p.b,to:"/addJourney/".concat(t.id)},"Add journey"),r.a.createElement($.a.Item,{as:p.b,to:"/addFuelPurchase/".concat(t.id)},"Add fuel purchase"))))),r.a.createElement(H.a.Collapse,{eventKey:"".concat(t.manufacturer," ").concat(t.model," (").concat(t.year,")")},r.a.createElement(K.a.Body,null,r.a.createElement(L.a,null,Object.keys(t.printDetails()).map((function(e,a){return r.a.createElement(L.a.Item,{key:a},e,": ",t.printDetails()[e])})),r.a.createElement(L.a.Item,null,"Tank capacity: ",t.tankCapacity," L"),r.a.createElement(L.a.Item,null,r.a.createElement(H.a,null,r.a.createElement(K.a,null,r.a.createElement(K.a.Header,null,r.a.createElement(H.a.Toggle,{className:"mr-auto",as:A.a,variant:"link",eventKey:"0"},"Booking Records")),r.a.createElement(H.a.Collapse,{eventKey:"0"},r.a.createElement(K.a.Body,null,a&&a.sort((function(e,t){return q()(t.startDate).isBefore(q()(e.startDate))})).map((function(e,t){return r.a.createElement(H.a,{key:t},r.a.createElement(K.a,null,r.a.createElement(K.a.Header,null,r.a.createElement(H.a.Toggle,{className:"mr-auto",as:A.a,variant:"link",eventKey:t},"".concat(new Date(e.startDate).toLocaleDateString("en-AU")," - ").concat(new Date(e.endDate).toLocaleDateString("en-AU"))),r.a.createElement(A.a,{onClick:function(){return i.setDeleteResourceModalShow("booking",e)},className:"mr-3",variant:"outline-danger"},r.a.createElement(G.a,{icon:Q.c}))),r.a.createElement(H.a.Collapse,{eventKey:t},r.a.createElement(K.a.Body,null,r.a.createElement(L.a,{key:e.id},r.a.createElement(L.a.Item,null,"Start Date: ",new Date(e.startDate).toLocaleDateString("en-AU")),r.a.createElement(L.a.Item,null,"End Date: ",new Date(e.endDate).toLocaleDateString("en-AU")),r.a.createElement(L.a.Item,null,"Start Odometer: ",e.startOdometer," km"),r.a.createElement(L.a.Item,null,"Booking Type: ","D"===e.bookingType?"Per day":"Per kilometer"),r.a.createElement(L.a.Item,null,"Booking cost: ","$ ".concat(Number.parseFloat(e.bookingCost).toFixed(2))))))))}))))))),r.a.createElement(L.a.Item,null,r.a.createElement(H.a,null,r.a.createElement(K.a,null,r.a.createElement(K.a.Header,null,r.a.createElement(H.a.Toggle,{className:"mr-auto",as:A.a,variant:"link",eventKey:"1"},"Journey Records")),r.a.createElement(H.a.Collapse,{eventKey:"1"},r.a.createElement(K.a.Body,null,t.bookings&&t.bookings.reduce((function(e,t){return t.journeys.forEach((function(t){e.push(t)})),e}),[]).sort((function(e,t){var a=new Date(e.journeyStartedAt),n=new Date(t.journeyStartedAt);return a>n?-1:a<n?1:0})).map((function(e,t){return r.a.createElement(H.a,{key:t},r.a.createElement(K.a,null,r.a.createElement(K.a.Header,null,r.a.createElement(H.a.Toggle,{className:"mr-auto",as:A.a,variant:"link",eventKey:t},"".concat(new Date(e.journeyStartedAt).toLocaleDateString("en-AU")," - ").concat(new Date(e.journeyEndedAt).toLocaleDateString("en-AU"))),r.a.createElement(A.a,{onClick:function(){return i.setDeleteResourceModalShow("journey",e)},className:"mr-3",variant:"outline-danger"},r.a.createElement(G.a,{icon:Q.c}))),r.a.createElement(H.a.Collapse,{eventKey:t},r.a.createElement(K.a.Body,null,r.a.createElement(L.a,{key:e.id},r.a.createElement(L.a.Item,null,"Journey started at: ",new Date(e.journeyStartedAt).toLocaleDateString("en-AU")),r.a.createElement(L.a.Item,null,"Journey ended at: ",new Date(e.journeyEndedAt).toLocaleDateString("en-AU")),r.a.createElement(L.a.Item,null,"Journey start odometer reading: ",e.journeyStartOdometerReading," km"),r.a.createElement(L.a.Item,null,"Journey end odometer reading: ",e.journeyEndOdometerReading," km"),r.a.createElement(L.a.Item,null,"Journey from: ",e.journeyFrom),r.a.createElement(L.a.Item,null,"Journey to: ",e.journeyTo))))))}))))))),r.a.createElement(L.a.Item,null,r.a.createElement(H.a,null,r.a.createElement(K.a,null,r.a.createElement(K.a.Header,null,r.a.createElement(H.a.Toggle,{className:"mr-auto",as:A.a,variant:"link",eventKey:"2"},"Service Records")),r.a.createElement(H.a.Collapse,{eventKey:"2"},r.a.createElement(K.a.Body,null,o.sort((function(e,t){var a=new Date(e.servicedAt),n=new Date(t.servicedAt);return a>n?-1:a>n?1:0})).map((function(e,t){return r.a.createElement(H.a,{key:t},r.a.createElement(K.a,{key:e.id},r.a.createElement(K.a.Header,null,r.a.createElement(H.a.Toggle,{className:"mr-auto",as:A.a,variant:"link",eventKey:t},new Date(e.servicedAt).toLocaleDateString("en-AU")),r.a.createElement(A.a,{onClick:function(){return i.setDeleteResourceModalShow("service",e)},className:"mr-3",variant:"outline-danger"},r.a.createElement(G.a,{icon:Q.c}))),r.a.createElement(H.a.Collapse,{eventKey:t},r.a.createElement(K.a.Body,null,r.a.createElement(L.a,null,r.a.createElement(L.a.Item,null,"Serviced at: ",new Date(e.servicedAt).toLocaleDateString("en-AU")),r.a.createElement(L.a.Item,null,"Service odometer: ",e.serviceOdometer," km"))))))}))))))),r.a.createElement(L.a.Item,null,r.a.createElement(H.a,null,r.a.createElement(K.a,null,r.a.createElement(K.a.Header,null,r.a.createElement(H.a.Toggle,{className:"mr-auto",as:A.a,variant:"link",eventKey:"3"},"Fuel Purchase Records")),r.a.createElement(H.a.Collapse,{eventKey:"3"},r.a.createElement(K.a.Body,null,t.bookings.reduce((function(e,t){return t.fuelPurchases.forEach((function(t){e.push(t)})),e}),[]).sort((function(e,t){var n=a.find((function(t){return t.id===e.bookingID})),r=new Date(n.startDate),o=a.find((function(e){return e.id===t.bookingID})),i=new Date(o.startDate);return r>i?-1:r<i?1:0})).map((function(e,t){return r.a.createElement(H.a,{key:t},r.a.createElement(K.a,null,r.a.createElement(K.a.Header,null,r.a.createElement(H.a.Toggle,{className:"mr-auto",as:A.a,variant:"link",eventKey:t},"".concat(new Date(a.find((function(t){return t.id===e.bookingID})).startDate).toLocaleDateString("en-AU")," - ").concat(new Date(a.find((function(t){return t.id===e.bookingID})).endDate).toLocaleDateString("en-AU"))),r.a.createElement(A.a,{onClick:function(){return i.setDeleteResourceModalShow("fuel purchase",e)},className:"mr-3",variant:"outline-danger"},r.a.createElement(G.a,{icon:Q.c}))),r.a.createElement(H.a.Collapse,{eventKey:t},r.a.createElement(K.a.Body,null,r.a.createElement(L.a,{key:e.id},r.a.createElement(L.a.Item,null,"Fuel quantity: ",e.fuelQuantity," L"),r.a.createElement(L.a.Item,null,"Fuel price (per litre): $ ",Number.parseFloat(e.fuelPrice).toFixed(2)),r.a.createElement(L.a.Item,null,"Total cost: $ ",(Number.parseFloat(e.fuelQuantity)*Number.parseFloat(e.fuelPrice)).toFixed(2)))))))})))))))))))),r.a.createElement(U,null))},X=function(){return r.a.createElement(M,null,(function(e){var t=e.loading,a=e.vehicles,n=e.notification;return r.a.createElement(w.a,null,n.display?r.a.createElement(B,{display:n.display,message:n.message}):"",r.a.createElement(R.a,null,r.a.createElement(T.a,null,r.a.createElement("h2",{className:"text-center my-5"},"All vehicles"))),r.a.createElement(U,null),t?r.a.createElement(R.a,{className:"justify-content-center mt-5"},r.a.createElement(F,null)):a.map((function(e,t){return r.a.createElement(W,{key:t,vehicle:e})})))}))},Z=function(){function e(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a(100)(),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:q()().format("DD/MM/YYYY hh:mm:ss A"),c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;Object(m.a)(this,e),this._id=o,this._vehicleID=t,this._serviceOdometer=n,this._servicedAt=r,this._createdAt=i,this._updatedAt=c}return Object(f.a)(e,[{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"vehicleID",get:function(){return this._vehicleID},set:function(e){this._vehicleID=e}},{key:"serviceOdometer",get:function(){return this._serviceOdometer},set:function(e){this._serviceOdometer=e}},{key:"servicedAt",get:function(){return this._servicedAt},set:function(e){this._servicedAt=e}},{key:"createdAt",get:function(){return this._createdAt},set:function(e){this._createdAt=e}},{key:"updatedAt",get:function(){return this._updatedAt},set:function(e){this._updatedAt=e}}]),e}();Z.getTotalServicesDone=function(e){return e.filter((function(e){return q()(e.servicedAt).isBefore(q()())})).length},Z.getLastServiceOdometerReading=function(e){if(e.length){var t=q()(),a=Object(d.a)(e).sort((function(e,t){var a=q()(e.servicedAt);return q()(t.servicedAt).diff(a,"days")})).find((function(e){return q()(e.servicedAt).isBefore(t)}));return a?a.serviceOdometer:"No services have been scheduled before today"}return"No services have been scheduled yet"},Z.requiresService=function(e){return e.some((function(e){return q()(e.servicedAt).isSameOrAfter(q()(),"days")}))};var ee=a(202),te=a.n(ee),ae={apiKey:Object({NODE_ENV:"production",PUBLIC_URL:"/car-rental-system"}).API_KEY||"AIzaSyBN2bR0_A7pSJQ3W-yU8_e8jgfj1HVHg98",authDomain:Object({NODE_ENV:"production",PUBLIC_URL:"/car-rental-system"}).AUTH_DOMAIN||"car-rental-system-725f7.firebaseapp.com",databaseURL:Object({NODE_ENV:"production",PUBLIC_URL:"/car-rental-system"}).DATABASE_URL||"https://car-rental-system-725f7.firebaseio.com",projectId:Object({NODE_ENV:"production",PUBLIC_URL:"/car-rental-system"}).PROJECT_ID||"car-rental-system-725f7",storageBucket:Object({NODE_ENV:"production",PUBLIC_URL:"/car-rental-system"}).STORAGE_BUCKET||"car-rental-system-725f7.appspot.com",messagingSenderId:Object({NODE_ENV:"production",PUBLIC_URL:"/car-rental-system"}).MESSAGING_SENDER_ID||"533494537845",appId:Object({NODE_ENV:"production",PUBLIC_URL:"/car-rental-system"}).APP_ID||"533494537845:web:8886eede71aaf00dde623c"};te.a.initializeApp(ae);var ne=function(){function e(t,n,r,o,i,c){var l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a(100)(),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:q()().format("DD/MM/YYYY hh:mm:ss A"),u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;Object(m.a)(this,e),this._bookings=[],this._services=[],this._id=l,this._manufacturer=t,this._model=n,this._year=r,this._odometerReading=o,this._registrationNumber=i,this._tankCapacity=c,this._createdAt=s,this._updatedAt=u}return Object(f.a)(e,[{key:"addBooking",value:function(e){this.bookings.push(e)}},{key:"removeBookingByID",value:function(e){if(e){var t=Object(d.a)(this.bookings),a=t.find((function(t){return t.id===e}));a&&(this.bookings=t.filter((function(e){return e.id!==a.id})))}}},{key:"removeJourneyByBookingID",value:function(e,t){this.bookings.find((function(e){return e.id===t})).removeJourney(e)}},{key:"addJourney",value:function(e){this.bookings.find((function(t){return t.id===e.bookingID})).addJourney(e)}},{key:"addService",value:function(e){this.services.push(e)}},{key:"removeServiceByID",value:function(e){if(e){var t=Object(d.a)(this.services),a=t.find((function(t){return t.id===e}));a&&(this.services=t.filter((function(e){return e.id!==a.id})))}}},{key:"addFuelPurchase",value:function(e){this.bookings.find((function(t){return t.id===e.bookingID})).addFuelPurchase(e)}},{key:"removeFuelPurchaseByBookingID",value:function(e,t){this.bookings.find((function(e){return e.id===t})).removeFuelPurchase(e)}},{key:"printDetails",value:function(){return{Vehicle:"".concat(this.manufacturer," ").concat(this.model," (").concat(this.year,")"),"Registration Number":this.registrationNumber,"Total Kilometers Travelled":"".concat(this.odometerReading," km"),"Total services done":Z.getTotalServicesDone(this.services),"Revenue recorded":"$ ".concat(Number.parseFloat(this.calculateRevenueRecorded()).toFixed(2)),"Kilometers since the last service":Number.parseFloat(Z.getLastServiceOdometerReading(this.services))?"".concat(this.odometerReading-Z.getLastServiceOdometerReading(this.services)," km"):Z.getLastServiceOdometerReading(this.services),"Requires service":Z.requiresService(this.services)?"Yes":"No"}}},{key:"calculateRevenueRecorded",value:function(){return this.bookings.reduce((function(e,t){return Number.parseFloat(t.bookingCost)&&(e+=t.bookingCost),e}),0)}},{key:"updateVehicleOdometer",value:function(e){if(this.bookings.length){var t=this.bookings.reduce((function(e,t){return t.journeys.length&&e.push.apply(e,Object(d.a)(t.journeys)),e}),[]).find((function(e){return q()(e.journeyEndedAt).isSame(q()(),"days")}));if(t&&t.journeyEndOdometerReading>this.odometerReading)this.odometerReading=t.journeyEndOdometerReading,te.a.firestore().collection("vehicles").doc(this.id).update({_odometerReading:this.odometerReading,_updatedAt:q()().format("DD/MM/YYYY hh:mm:ss a")}).then(e).catch(console.dir)}}},{key:"bookings",get:function(){return this._bookings},set:function(e){this._bookings=e}},{key:"journeys",get:function(){return this._bookings.reduce((function(e,t){return t.journeys.forEach((function(t){e.push(t)})),e}),[])}},{key:"services",get:function(){return this._services},set:function(e){this._services=e}},{key:"fuelPurchases",get:function(){return this._fuelPurchases},set:function(e){this._fuelPurchases=e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"manufacturer",get:function(){return this._manufacturer},set:function(e){this._manufacturer=e}},{key:"model",get:function(){return this._model},set:function(e){this._model=e}},{key:"year",get:function(){return this._year},set:function(e){this._year=e}},{key:"odometerReading",get:function(){return this._odometerReading},set:function(e){this._odometerReading=e}},{key:"registrationNumber",get:function(){return this._registrationNumber},set:function(e){this._registrationNumber=e}},{key:"tankCapacity",get:function(){return this._tankCapacity},set:function(e){this._tankCapacity=e}},{key:"createdAt",get:function(){return this._createdAt},set:function(e){this._createdAt=e}},{key:"updatedAt",get:function(){return this._updatedAt},set:function(e){this._updatedAt=e}}]),e}(),re=a(49),oe=a(12),ie=oe.object().shape({manufacturer:oe.string().trim().required("This field is required"),model:oe.string().trim().required("This field is required"),year:oe.number().min(q()().subtract(70,"years").get("year"),"Too old").max(q()().add(1,"year").get("year"),"Invalid year"),registrationNumber:oe.string().trim().length(7,"7 characters are required").matches(/^[A-Za-z0-9]{7}$/,"Only letters and numbers are valid").required("This field is required"),odometerReading:oe.number().min(0,"Invalid reading").required("This field is required"),tankCapacity:oe.number().min(0,"Invalid tank capacity")}),ce=function(e){var t=Object(n.useContext)(j),a=t.loading,o=t.notification,i=Object(C.f)(),c=Object(n.useRef)(null),l=e.vehicle,s=e.handleSubmit,u=e.type;return r.a.createElement(w.a,null,o&&o.display?r.a.createElement(B,{display:o.display,message:o.message}):"",r.a.createElement(R.a,null,r.a.createElement(T.a,null,"add"===u?r.a.createElement("h2",{className:"text-center my-5"},"Add a new vehicle"):r.a.createElement("h2",{className:"text-center my-5"},"Edit vehicle: ",l?"".concat(l.manufacturer," ").concat(l.model," (").concat(l.year,")"):""))),a?r.a.createElement(R.a,{className:"justify-content-center mt-5"},r.a.createElement(F,null)):r.a.createElement(re.a,{validationSchema:ie,onSubmit:function(e){return s(e)},initialValues:{manufacturer:l?l.manufacturer:"",model:l?l.model:"",year:l?l.year:"",registrationNumber:l?l.registrationNumber:"",odometerReading:l?l.odometerReading:"",tankCapacity:l?l.tankCapacity:""}},(function(e){var t=e.handleSubmit,a=e.handleChange,n=e.resetForm,o=e.values,l=e.touched,s=e.errors,d=e.isSubmitting;return r.a.createElement(S.a,{noValidate:!0,onSubmit:t},r.a.createElement(S.a.Row,{className:"mb-lg-3"},r.a.createElement(S.a.Group,{as:T.a,controlId:"manufacturer",lg:"4",md:"12"},r.a.createElement(S.a.Label,null,"Manufacturer:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(S.a.Control,{ref:c,onChange:a,name:"manufacturer",value:o.manufacturer,type:"text",placeholder:"Manufacturer...",isInvalid:!!s.manufacturer,isValid:l.manufacturer&&!s.manufacturer}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},s.manufacturer)),r.a.createElement(S.a.Group,{as:T.a,controlId:"model",lg:"4",md:"12"},r.a.createElement(S.a.Label,null,"Model:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(S.a.Control,{onChange:a,name:"model",value:o.model,type:"text",placeholder:"Model...",isValid:l.model&&!s.model,isInvalid:!!s.model}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},s.model)),r.a.createElement(S.a.Group,{as:T.a,controlId:"year",lg:"4",md:"12"},r.a.createElement(S.a.Label,null,"Year:"),r.a.createElement(S.a.Control,{onChange:a,name:"year",value:o.year,type:"number",min:q()().subtract(60,"years").get("year"),max:q()().add(1,"year").get("year"),step:"1",placeholder:"Year...",isValid:l.year&&!s.year,isInvalid:!!s.year}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},s.year))),r.a.createElement(S.a.Row,{className:"mb-lg-3"},r.a.createElement(S.a.Group,{as:T.a,controlId:"registrationNumber",lg:"6",md:"12"},r.a.createElement(S.a.Label,null,"Registration Number:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(S.a.Control,{onChange:a,name:"registrationNumber",value:o.registrationNumber,type:"text",placeholder:"Registration Number...",isValid:l.registrationNumber&&!s.registrationNumber,isInvalid:!!s.registrationNumber}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},s.registrationNumber))),r.a.createElement(S.a.Row,{className:"mb-lg-3"},r.a.createElement(S.a.Group,{as:T.a,controlId:"odometerReading",lg:"6",md:"12"},r.a.createElement(S.a.Label,null,"Odometer Reading (in kilometres):",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(S.a.Control,{onChange:a,name:"odometerReading",value:o.odometerReading,type:"number",placeholder:"Odometer Reading...",isValid:l.odometerReading&&!s.odometerReading,isInvalid:!!s.odometerReading}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},s.odometerReading))),r.a.createElement(S.a.Row,{className:"mb-lg-5"},r.a.createElement(S.a.Group,{as:T.a,controlId:"tankCapacity",lg:"6",md:"12"},r.a.createElement(S.a.Label,null,"Tank Capacity (in litres):"),r.a.createElement(S.a.Control,{onChange:a,name:"tankCapacity",value:o.tankCapacity,type:"number",placeholder:"Tank Capacity...",isValid:l.tankCapacity&&!s.tankCapacity,isInvalid:!!s.tankCapacity}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},s.tankCapacity))),r.a.createElement(R.a,{className:"justify-content-center"},r.a.createElement(A.a,{variant:"primary",size:"lg",type:"submit",className:"mr-5",disabled:d},"add"===u?"Add vehicle":"Edit vehicle"),r.a.createElement(A.a,{variant:"warning",size:"lg",className:"mr-5",onClick:function(){n(),c.current.focus()}},"add"===u?"Clear":"Restore"),r.a.createElement(A.a,{variant:"danger",size:"lg",onClick:function(){return i.push("/browse")}},"Cancel")))})))},le=function(){var e=Object(n.useContext)(j).addResource,t=Object(C.f)();return r.a.createElement(ce,{type:"add",handleSubmit:function(a){var n=a.manufacturer,r=a.model,o=a.year,i=a.odometerReading,c=a.registrationNumber,l=a.tankCapacity,s=new ne(n,r,o,i,c,l);e("vehicle",s),t.push("/show/".concat(s.id))}})},se=a(103),ue=function(){var e=Object(n.useContext)(j),t=e.vehicles,a=e.editVehicle,o=Object(C.f)(),i=Object(C.g)().vehicleID,c=t.find((function(e){return e.id===i})),l=se(c);return r.a.createElement(ce,{type:"edit",vehicle:l,handleSubmit:function(e){for(var t in e)l.hasOwnProperty("_".concat(t))&&(l[t]=e[t]);l.updatedAt=q()().format("DD/MM/YYYY hh:mm:ss A"),a(l),o.push("/browse/".concat(l.id))}})},de=a(75),me=function(){function e(t,n,r,o,i){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:a(100)(),l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:q()().format("DD/MM/YYYY hh:mm:ss A"),s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;Object(m.a)(this,e),this._journeys=[],this._fuelPurchases=[],this._id=c,this._vehicleID=t,this._bookingType=n,this._startDate=r,this._endDate=o,this._startOdometer=i,this._createdAt=l,this._updatedAt=s,this._bookingCost=this.calculateBookingCost()}return Object(f.a)(e,[{key:"addFuelPurchase",value:function(e){this.fuelPurchases.push(e)}},{key:"addJourney",value:function(e){this.journeys.push(e),this.bookingCost=this.calculateBookingCost()}},{key:"removeJourney",value:function(e){this.journeys=this.journeys.filter((function(t){return t.id!==e.id})),this.bookingCost=this.calculateBookingCost()}},{key:"removeFuelPurchase",value:function(e){this.fuelPurchases=this.fuelPurchases.filter((function(t){return t.id!==e.id}))}},{key:"calculateBookingCost",value:function(){var e=0;"D"===this.bookingType?e=100*q()(this.endDate).diff(this.startDate,"days"):this.journeys.length&&(e=this.journeys.reduce((function(e,t){return e+=t.journeyEndOdometerReading-t.journeyStartOdometerReading}),0));return e}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"vehicleID",get:function(){return this._vehicleID},set:function(e){this._vehicleID=e}},{key:"bookingType",get:function(){return this._bookingType},set:function(e){this._bookingType=e}},{key:"startDate",get:function(){return this._startDate},set:function(e){this._startDate=e}},{key:"endDate",get:function(){return this._endDate},set:function(e){this._endDate=e}},{key:"startOdometer",get:function(){return this._startOdometer},set:function(e){this._startOdometer=e}},{key:"createdAt",get:function(){return this._createdAt},set:function(e){this._createdAt=e}},{key:"updatedAt",get:function(){return this._updatedAt},set:function(e){this._updatedAt=e}},{key:"journeys",get:function(){return this._journeys},set:function(e){this._journeys=e}},{key:"bookingCost",get:function(){return this._bookingCost},set:function(e){this._bookingCost=e}},{key:"fuelPurchases",get:function(){return this._fuelPurchases},set:function(e){this._fuelPurchases=e}}]),e}(),fe=function(e){return r.a.createElement(V.a,{show:e.show,onHide:e.cancelHandler,size:"xl","aria-labelledby":"contained-modal-title-vcenter",centered:!0},r.a.createElement(V.a.Header,{closeButton:!0},r.a.createElement(V.a.Title,{id:"contained-modal-title-vcenter"},"Warning")),r.a.createElement(V.a.Body,null,r.a.createElement("h4",null,e.header),r.a.createElement("p",null,e.body)),r.a.createElement(V.a.Footer,null,r.a.createElement(A.a,{onClick:e.acceptHandler,size:"lg",variant:"danger"},e.accept),r.a.createElement(A.a,{variant:"info",size:"lg",onClick:e.cancelHandler},e.cancel)))},he=Object(de.extendMoment)(q.a),ye=a(103),ge=function(){var e=Object(n.useContext)(j),t=e.loading,a=e.notification,o=e.vehicles,i=e.addResource,c=e.deleteResource,l=Object(n.useState)({status:!1,booking:null}),s=Object(D.a)(l,2),u=s[0],d=s[1],m=Object(n.useState)({status:!1,service:null}),f=Object(D.a)(m,2),h=f[0],y=f[1],g=Object(n.useState)(null),v=Object(D.a)(g,2),E=v[0],b=v[1],p=Object(n.useState)(!1),k=Object(D.a)(p,2),Y=k[0],O=k[1],M=Object(C.g)().vehicleID,I=Object(C.f)(),_=o.find((function(e){return e.id===M})),N=ye(_),P=oe.object().shape({bookingType:oe.string().required("This field is required"),startDate:oe.date().min(he().subtract(1,"day"),"Start date cannot be earlier than today").max(he(he(),"YYYY-MM-DD").add(1,"year"),"Invalid date").required("This field is required"),endDate:oe.date().min(he().subtract(1,"day"),"Invalid date").min(oe.ref("startDate"),"End date cannot be earlier start date").max(he(he(),"YYYY-MM-DD").add(1,"year"),"Invalid date").required("This field is required"),startOdometer:oe.number().min(N?N.odometerReading:0,"Cannot be lower than current odometer reading").required("This field is required")}),x=function(e,t,a,n){c.confirmDeleteResource(e,t),c.setDeleteResourceModalShow(null,null,(function(){i(a,n),I.push("/show/".concat(N.id))}))};return Object(n.useEffect)((function(){Y&&E&&(i("booking",E),I.push("/show/".concat(N.id)))}),[Y]),r.a.createElement(w.a,null,a&&a.display?r.a.createElement(B,{display:a.display,message:a.message}):"",r.a.createElement(R.a,null,r.a.createElement(T.a,null,r.a.createElement("h2",{className:"text-center my-5"},"Add new booking for: ",N?"".concat(N.manufacturer," ").concat(N.model," (").concat(N.year,")"):""))),r.a.createElement(fe,{onHide:function(){return d({status:!1})},show:u.status,header:"Booking conflict",body:"New booking could not be added to the system, because there is another booking scheduled between ".concat(u.booking?he(u.booking.startDate,"YYYY-MM-DD").format("DD/MM/YYYY"):""," and ").concat(u.booking?he(u.booking.endDate,"YYYY-MM-DD").format("DD/MM/YYYY"):"",". Would you like to cancel the other booking and add this one now?"),accept:"Yes, cancel the other booking",cancel:"No, keep it as it is",acceptHandler:function(){x("booking",u.booking,"booking",E)},cancelHandler:function(){return d({status:!1})}}),r.a.createElement(fe,{onHide:function(){return y({status:!1})},show:h.status,header:"Service conflict",body:"New booking could not be added to the system, because there is a service scheduled for ".concat(h.service?he(h.service.servicedAt,"YYYY-MM-DD").format("DD/MM/YYYY"):"",". Would you like to cancel that service and add this booking?"),accept:"Yes, cancel the service",cancel:"No, keep it as it is",acceptHandler:function(){x("service",h.service,"booking",E)},cancelHandler:function(){return y({status:!1})}}),t?r.a.createElement(R.a,{className:"justify-content-center mt-5"},r.a.createElement(F,null)):r.a.createElement(re.a,{validationSchema:P,onSubmit:function(e){var t=e.bookingType,a=e.startDate,n=e.endDate,r=e.startOdometer,o=new me(N.id,t,a,n,r);if(b(o),N.bookings.some((function(e){return he.range(he(e.startDate,"YYYY-MM-DD"),he(e.endDate,"YYYY-MM-DD")).overlaps(he.range(he(a,"YYYY-MM-DD"),he(n,"YYYY-MM-DD")))}))){var i=N.bookings.find((function(e){return he.range(he(e.startDate,"YYYY-MM-DD"),he(e.endDate,"YYYY-MM-DD")).overlaps(he.range(he(a,"YYYY-MM-DD"),he(n,"YYYY-MM-DD")))}));d({status:!0,booking:i})}else if(N.services.some((function(e){return he(e.servicedAt,"YYYY-MM-DD").within(he.range(he(a,"YYYY-MM-DD"),he(n,"YYYY-MM-DD")))}))){var c=N.services.find((function(e){return he(e.servicedAt,"YYYY-MM-DD").within(he.range(he(a,"YYYY-MM-DD"),he(n,"YYYY-MM-DD")))}));y({status:!0,service:c})}else O(!0)},initialValues:{bookingType:"D",startDate:he(he(),"YYYY-MM-DD").format("YYYY-MM-DD"),endDate:he(he(),"YYYY-MM-DD").add(1,"day").format("YYYY-MM-DD"),startOdometer:N?N.odometerReading:0}},(function(e){var t=e.handleSubmit,a=e.handleChange,n=e.resetForm,o=e.values,i=e.touched,c=e.errors,l=e.isSubmitting;return r.a.createElement(S.a,{onSubmit:t},r.a.createElement(S.a.Group,{as:R.a,controlId:"bookingType"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Booking Type:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{as:"select",name:"bookingType",value:o.bookingType,onChange:a,isValid:i.bookingType&&!c.bookingType,isInvalid:!!c.bookingType},r.a.createElement("option",{value:"D"},"Per day"),r.a.createElement("option",{value:"K"},"Per kilometer")),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.bookingType))),r.a.createElement(S.a.Group,{as:R.a,controlId:"startDate"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Start Date:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"startDate",value:o.startDate,type:"date",isInvalid:!!c.startDate,isValid:i.startDate&&!c.startDate}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.startDate))),r.a.createElement(S.a.Group,{as:R.a,controlId:"endDate"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"End Date:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"endDate",value:o.endDate,type:"date",isInvalid:!!c.endDate,isValid:i.endDate&&!c.endDate}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.endDate))),r.a.createElement(S.a.Group,{as:R.a,controlId:"startOdometer"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Start Odometer:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"startOdometer",value:o.startOdometer,type:"number",placeholder:"Start odometer...",isValid:i.startOdometer&&!c.startOdometer,isInvalid:!!c.startOdometer}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.startOdometer))),r.a.createElement(R.a,{className:"justify-content-center my-5"},r.a.createElement(A.a,{variant:"primary",size:"lg",type:"submit",className:"mr-5",disabled:l},"Add booking"),r.a.createElement(A.a,{variant:"warning",size:"lg",className:"mr-5",onClick:n},"Clear"),r.a.createElement(A.a,{variant:"danger",size:"lg",onClick:function(){return I.push("/show/".concat(M))}},"Cancel")))})))},ve=a(103),Ee=Object(de.extendMoment)(q.a),be=function(){var e=Object(n.useContext)(j),t=e.loading,a=e.notification,o=e.vehicles,i=e.addResource,c=e.deleteResource,l=Object(n.useState)({status:!1,booking:null}),s=Object(D.a)(l,2),u=s[0],d=s[1],m=Object(n.useState)({status:!1,service:null}),f=Object(D.a)(m,2),h=f[0],y=f[1],g=Object(n.useState)(null),v=Object(D.a)(g,2),E=v[0],b=v[1],p=Object(n.useState)(!1),k=Object(D.a)(p,2),Y=k[0],O=k[1],M=Object(C.g)().vehicleID,I=Object(C.f)(),_=o.find((function(e){return e.id===M})),N=ve(_),P=function(e,t,a,n){c.confirmDeleteResource(e,t),c.setDeleteResourceModalShow(null,null,(function(){i(a,n),I.push("/show/".concat(N.id))}))},x=oe.object().shape({servicedAt:oe.date().min(Ee().subtract(1,"day"),"Invalid date").required("This field is required"),serviceOdometer:oe.number().min(N?N.odometerReading:0,"Invalid service odometer").required("This field is required")});return Object(n.useEffect)((function(){Y&&E&&(i("service",E),I.push("/show/".concat(N.id)))}),[Y]),r.a.createElement(w.a,null,a&&a.display?r.a.createElement(B,{display:a.display,message:a.message}):"",r.a.createElement(R.a,null,r.a.createElement(T.a,null,r.a.createElement("h2",{className:"text-center my-5"},"Register new service for: ",N?"".concat(N.manufacturer," ").concat(N.model," (").concat(N.year,")"):""))),r.a.createElement(fe,{onHide:function(){return d({status:!1})},show:u.status,header:"Booking conflict",body:"New service could not be added to the system, because there is a booking scheduled between ".concat(u.booking?Ee(u.booking.startDate,"YYYY-MM-DD").format("DD/MM/YYYY"):""," and ").concat(u.booking?Ee(u.booking.endDate,"YYYY-MM-DD").format("DD/MM/YYYY"):"",". Would you like to cancel the booking and add this service now?"),accept:"Yes, cancel this booking",cancel:"No, keep it as it is",acceptHandler:function(){P("booking",u.booking,"service",E)},cancelHandler:function(){return d({status:!1})}}),r.a.createElement(fe,{onHide:function(){return y({status:!1})},show:h.status,header:"Service conflict",body:"New service could not be added to the system, because there is another service also scheduled for ".concat(h.service?Ee(h.service.servicedAt,"YYYY-MM-DD").format("DD/MM/YYYY"):"",". Would you like to cancel that service and add this one instead?"),accept:"Yes, cancel the other service",cancel:"No, keep it as it is",acceptHandler:function(){P("service",h.service,"service",E)},cancelHandler:function(){return y({status:!1})}}),t?r.a.createElement(R.a,{className:"justify-content-center mt-5"},r.a.createElement(F,null)):r.a.createElement(re.a,{validationSchema:x,onSubmit:function(e){var t=e.serviceOdometer,a=e.servicedAt,n=new Z(N.id,t,a);if(b(n),N.bookings.some((function(e){return Ee(a,"YYYY-MM-DD").within(Ee.range(e.startDate,e.endDate))}))){var r=N.bookings.find((function(e){return Ee(a,"YYYY-MM-DD").within(Ee.range(e.startDate,e.endDate))}));d({status:!0,booking:r})}else if(N.services.some((function(e){return Ee(e.servicedAt,"YYYY-MM-DD").isSame(Ee(a,"YYYY-MM-DD"))}))){var o=N.services.find((function(e){return Ee(e.servicedAt,"YYYY-MM-DD").isSame(Ee(a,"YYYY-MM-DD"))}));y({status:!0,service:o})}else O(!0)},initialValues:{servicedAt:Ee(Ee(),"YYYY-MM-DD").format("YYYY-MM-DD"),serviceOdometer:N?N.odometerReading:0}},(function(e){var t=e.handleSubmit,a=e.handleChange,n=e.resetForm,o=e.values,i=e.touched,c=e.errors,l=e.isSubmitting;return r.a.createElement(S.a,{noValidate:!0,onSubmit:t},r.a.createElement(S.a.Group,{as:R.a,controlId:"servicedAt"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Serviced at:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"servicedAt",value:o.servicedAt,type:"date",isInvalid:!!c.servicedAt,isValid:i.servicedAt&&!c.servicedAt}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.servicedAt))),r.a.createElement(S.a.Group,{as:R.a,controlId:"serviceOdometer"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Service odometer:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"serviceOdometer",value:o.serviceOdometer,type:"number",placeholder:"Service odometer...",isValid:i.serviceOdometer&&!c.serviceOdometer,isInvalid:!!c.serviceOdometer}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.serviceOdometer))),r.a.createElement(R.a,{className:"justify-content-center"},r.a.createElement(A.a,{variant:"primary",size:"lg",type:"submit",className:"mr-5",disabled:l},"Add service"),r.a.createElement(A.a,{variant:"warning",size:"lg",className:"mr-5",onClick:function(){n()}},"Clear"),r.a.createElement(A.a,{variant:"danger",size:"lg",onClick:function(){return I.push("/show/".concat(M))}},"Cancel")))})))},pe=a(151);function ke(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function De(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ke(a,!0).forEach((function(t){Object(u.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ke(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Ye=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(h.a)(this,Object(y.a)(t).call(this,e))).initialState={vehicle:"",fields:{id:"",bookingID:"",journeyStartedAt:"",journeyEndedAt:"",journeyStartOdometerReading:"",journeyEndOdometerReading:"",journeyFrom:"",journeyTo:"",createdAt:"",updatedAt:null}},a.state=De({},a.initialState),a}return Object(g.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.match.params.vehicleID,t=this.context.vehicles.find((function(t){return t.id===e}));this.setState(De({},this.initialState,{vehicle:t}))}},{key:"render",value:function(){var e=this;return r.a.createElement(M,null,(function(t){var a=t.loading,n=t.notification;return r.a.createElement(w.a,null,n.display?r.a.createElement(B,{display:n.display,message:n.message}):"",r.a.createElement(R.a,null,r.a.createElement(T.a,null,r.a.createElement("h2",{className:"text-center my-5"},"Select a booking to add a new journey for ",e.state.vehicle?"".concat(e.state.vehicle.manufacturer," ").concat(e.state.vehicle.model," (").concat(e.state.vehicle.year,")"):""))),a?r.a.createElement(R.a,{className:"justify-content-center mt-5"},r.a.createElement(F,null)):r.a.createElement(H.a,null,e.state.vehicle?e.state.vehicle.bookings.filter((function(t){return t.vehicleID===e.state.vehicle.id})).sort((function(e,t){var a=new Date(e.startDate),n=new Date(t.startDate);return a>n?-1:a<n?1:0})).map((function(e,t){return r.a.createElement(K.a,{key:t,style:{overflow:"visible"}},r.a.createElement(K.a.Header,null,r.a.createElement(H.a.Toggle,{className:"mr-auto",as:A.a,variant:"link",eventKey:t},"".concat(new Date(e.startDate).toLocaleDateString("en-AU"))),r.a.createElement(p.b,{to:"/addJourneyForm/".concat(e.id)},r.a.createElement(A.a,{variant:"outline-success"},r.a.createElement(G.a,{icon:pe.faPlus})))),r.a.createElement(H.a.Collapse,{eventKey:t},r.a.createElement(K.a.Body,null,r.a.createElement(L.a,null,r.a.createElement(L.a.Item,null,"Start Date: ","".concat(new Date(e.startDate).toLocaleDateString("en-AU"))),r.a.createElement(L.a.Item,null,"End Date: ","".concat(new Date(e.endDate).toLocaleDateString("en-AU"))),r.a.createElement(L.a.Item,null,"Start Odometer: ",e.startOdometer," km"),r.a.createElement(L.a.Item,null,"Booking Type: ","D"===e.bookingType?"Per day":"Per km")))))})):""),r.a.createElement(A.a,{className:"my-5",style:{position:"relative",left:"50%",transform:"translateX(-50%)"},variant:"danger",size:"lg",onClick:function(){return e.props.history.push("/show/".concat(e.state.vehicle.id))}},"Cancel"))}))}}]),t}(r.a.Component);Ye.contextType=j;var je=function(){function e(t,n,r,o,i,c,l){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:a(100)(),u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:q()().format("DD/MM/YYYY hh:mm:ss A"),d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;Object(m.a)(this,e),this._id=s,this._bookingID=t,this._journeyStartOdometerReading=n,this._journeyEndOdometerReading=r,this._journeyStartedAt=o,this._journeyEndedAt=i,this._journeyFrom=c,this._journeyTo=l,this._createdAt=u,this._updatedAt=d}return Object(f.a)(e,[{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"bookingID",get:function(){return this._bookingID},set:function(e){this._bookingID=e}},{key:"journeyStartOdometerReading",get:function(){return this._journeyStartOdometerReading},set:function(e){this._journeyStartOdometerReading=e}},{key:"journeyEndOdometerReading",get:function(){return this._journeyEndOdometerReading},set:function(e){this._journeyEndOdometerReading=e}},{key:"journeyStartedAt",get:function(){return this._journeyStartedAt},set:function(e){this._journeyStartedAt=e}},{key:"journeyEndedAt",get:function(){return this._journeyEndedAt},set:function(e){this._journeyEndedAt=e}},{key:"journeyFrom",get:function(){return this._journeyFrom},set:function(e){this._journeyFrom=e}},{key:"journeyTo",get:function(){return this._journeyTo},set:function(e){this._journeyTo=e}},{key:"createdAt",get:function(){return this._createdAt},set:function(e){this._createdAt=e}},{key:"updatedAt",get:function(){return this._updatedAt},set:function(e){this._updatedAt=e}}]),e}(),Oe=Object(de.extendMoment)(q.a),Me=a(103),Se=function(){var e=Object(n.useContext)(j),t=e.loading,a=e.notification,o=e.vehicles,i=e.addResource,c=Object(n.useState)(null),l=Object(D.a)(c,2),s=l[0],u=l[1],d=Object(n.useState)(!1),m=Object(D.a)(d,2),f=m[0],h=m[1],y=Object(C.g)().bookingID,g=Object(C.f)(),v=o.find((function(e){return e.bookings.some((function(e){return e.id===y}))})),E=Me(v),b=E?E.bookings.find((function(e){return e.id===y})):null,p=Me(b),k=oe.object().shape({journeyStartOdometerReading:oe.number().min(p?p.startOdometer:0,"Invalid odometer reading").required("This field is required"),journeyEndOdometerReading:oe.number().min(p?p.startOdometer:0,"Invalid odometer reading").min(oe.ref("journeyStartOdometerReading"),"Cannot be lower than journey start odometer reading").required("This field is required"),journeyStartedAt:oe.date().min(p?Oe(p.startDate,"YYYY-MM-DD"):Oe(Oe(),"YYYY-MM-DD").format("YYYY-MM-DD"),"Cannot be earlier than booking start date").required("This field is required"),journeyEndedAt:oe.date().min(p?Oe(p.startDate,"YYYY-MM-DD"):Oe(Oe(),"YYYY-MM-DD").format("YYYY-MM-DD"),"Cannot be earlier than booking start date").min(oe.ref("journeyStartedAt"),"Cannot be earlier than journey start date").max(p?Oe(p.endDate,"YYYY-MM-DD"):Oe(Oe(),"YYYY-MM-DD").format("YYYY-MM-DD"),"Cannot be later than booking end date").required("This field is required"),journeyFrom:oe.string(),journeyTo:oe.string()});return Object(n.useEffect)((function(){f&&s&&(i("journey",s),g.push("/show/".concat(E.id)))}),[f]),r.a.createElement(w.a,null,a&&a.display?r.a.createElement(B,{display:a.display,message:a.message}):"",r.a.createElement(R.a,null,r.a.createElement(T.a,null,r.a.createElement("h2",{className:"text-center my-5"},"Add new journey for ",E?"".concat(E.manufacturer," ").concat(E.model," (").concat(E.year,")"):"",", booked for: ",p?"".concat(Oe(p.startDate,"YYYY-MM-DD").format("DD/MM/YYYY")):""," - ",p?"".concat(Oe(p.endDate,"YYYY-MM-DD").format("DD/MM/YYYY")):""))),t?r.a.createElement(R.a,{className:"justify-content-center mt-5"},r.a.createElement(F,null)):r.a.createElement(re.a,{validationSchema:k,onSubmit:function(e){var t=e.journeyStartOdometerReading,a=e.journeyEndOdometerReading,n=e.journeyStartedAt,r=e.journeyEndedAt,o=e.journeyFrom,i=e.journeyTo,c=new je(y,t,a,n,r,o,i);u(c),h(!0)},initialValues:{journeyStartOdometerReading:p?p.startOdometer:0,journeyEndOdometerReading:p?p.startOdometer:0,journeyStartedAt:p?p.startDate:Oe(Oe(),"YYYY-MM-DD").format("YYYY-MM-DD"),journeyEndedAt:p?p.startDate:Oe(Oe(),"YYYY-MM-DD").format("YYYY-MM-DD"),journeyFrom:"",journeyTo:""}},(function(e){var t=e.handleSubmit,a=e.handleChange,n=e.resetForm,o=e.values,i=e.touched,c=e.errors,l=e.isSubmitting;return r.a.createElement(S.a,{onSubmit:t},r.a.createElement(S.a.Group,{as:R.a,controlId:"journeyStartedAt"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Journey started at:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"journeyStartedAt",value:o.journeyStartedAt,type:"date",isValid:i.journeyStartedAt&&!c.journeyStartedAt,isInvalid:!!c.journeyStartedAt}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.journeyStartedAt))),r.a.createElement(S.a.Group,{as:R.a,controlId:"journeyEndedAt"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Journey ended at:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"journeyEndedAt",value:o.journeyEndedAt,type:"date",isValid:i.journeyEndedAt&&!c.journeyEndedAt,isInvalid:!!c.journeyEndedAt}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.journeyEndedAt))),r.a.createElement(S.a.Group,{as:R.a,controlId:"journeyStartOdometerReading"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Journey start odometer reading:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"journeyStartOdometerReading",value:o.journeyStartOdometerReading,type:"number",placeholder:"Journey start odometer reading...",isValid:i.journeyStartOdometerReading&&!c.journeyStartOdometerReading,isInvalid:!!c.journeyStartOdometerReading}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.journeyStartOdometerReading))),r.a.createElement(S.a.Group,{as:R.a,controlId:"journeyEndOdometerReading"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Journey end odometer reading:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"journeyEndOdometerReading",value:o.journeyEndOdometerReading,placeholder:"Journey end odometer reading...",type:"number",isValid:i.journeyEndOdometerReading&&!c.journeyEndOdometerReading,isInvalid:!!c.journeyEndOdometerReading}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.journeyEndOdometerReading))),r.a.createElement(S.a.Group,{as:R.a,controlId:"journeyFrom"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Journey from:"),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"journeyFrom",value:o.journeyFrom,placeholder:"Journey from...",type:"text",isValid:i.journeyFrom&&!c.journeyFrom,isInvalid:!!c.journeyFrom}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.journeyFrom))),r.a.createElement(S.a.Group,{as:R.a,controlId:"journeyTo"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Journey to:"),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"journeyTo",value:o.journeyTo,placeholder:"Journey to...",type:"text",isValid:i.journeyTo&&!c.journeyTo,isInvalid:!!c.journeyTo}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.journeyTo))),r.a.createElement(R.a,{className:"justify-content-center my-5"},r.a.createElement(A.a,{variant:"primary",size:"lg",type:"submit",className:"mr-5",disabled:l},"Add journey"),r.a.createElement(A.a,{variant:"warning",size:"lg",className:"mr-5",onClick:n},"Clear"),r.a.createElement(A.a,{variant:"danger",size:"lg",onClick:function(){return g.push("/show/".concat(E.id))}},"Cancel")))})))};function Ie(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ae(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ie(a,!0).forEach((function(t){Object(u.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ie(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Ce=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(h.a)(this,Object(y.a)(t).call(this,e))).initialState={vehicle:""},a.state=Ae({},a.initialState),a}return Object(g.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.match.params.vehicleID,t=this.context.vehicles.find((function(t){return t.id===e}));this.initialState={vehicle:t},this.setState(Ae({},this.initialState))}},{key:"render",value:function(){var e=this;return r.a.createElement(M,null,(function(t){var a=t.loading,n=t.notification;return r.a.createElement(w.a,null,n.display?r.a.createElement(B,{display:n.display,message:n.message}):"",r.a.createElement(R.a,null,r.a.createElement(T.a,null,r.a.createElement("h2",{className:"text-center my-5"},"Select a booking to register a new fuel purchase for ",e.state.vehicle?"".concat(e.state.vehicle.manufacturer," ").concat(e.state.vehicle.model," (").concat(e.state.vehicle.year,")"):""))),a?r.a.createElement(R.a,{className:"justify-content-center mt-5"},r.a.createElement(F,null)):r.a.createElement(H.a,null,e.state.vehicle?e.state.vehicle.bookings.filter((function(t){return t.vehicleID===e.state.vehicle.id})).sort((function(e,t){var a=new Date(e.startDate),n=new Date(t.startDate);return a>n?-1:a<n?1:0})).map((function(e,t){return r.a.createElement(K.a,{key:t,style:{overflow:"visible"}},r.a.createElement(K.a.Header,null,r.a.createElement(H.a.Toggle,{className:"mr-auto",as:A.a,variant:"link",eventKey:t},"".concat(new Date(e.startDate).toLocaleDateString("en-AU"))),r.a.createElement(p.b,{to:"/addFuelPurchaseForm/".concat(e.id)},r.a.createElement(A.a,{variant:"outline-success"},r.a.createElement(G.a,{icon:pe.faPlus})))),r.a.createElement(H.a.Collapse,{eventKey:t},r.a.createElement(K.a.Body,null,r.a.createElement(L.a,null,r.a.createElement(L.a.Item,null,"Start Date: ","".concat(new Date(e.startDate).toLocaleDateString("en-AU"))),r.a.createElement(L.a.Item,null,"End Date: ","".concat(new Date(e.endDate).toLocaleDateString("en-AU"))),r.a.createElement(L.a.Item,null,"Start Odometer: ",e.startOdometer," km"),r.a.createElement(L.a.Item,null,"Booking Type: ","D"===e.bookingType?"Per day":"Per km")))))})):""),r.a.createElement(A.a,{className:"my-5",style:{position:"relative",left:"50%",transform:"translateX(-50%)"},variant:"danger",size:"lg",onClick:function(){return e.props.history.push("/show/".concat(e.state.vehicle.id))}},"Cancel"))}))}}]),t}(r.a.Component);Ce.contextType=j;var _e=function(){function e(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a(100)(),i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:q()().format("DD/MM/YYYY hh:mm:ss A"),c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;Object(m.a)(this,e),this._id=o,this._bookingID=t,this._fuelPrice=r,this._fuelQuantity=n,this._createdAt=i,this._updatedAt=c}return Object(f.a)(e,[{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"bookingID",get:function(){return this._bookingID},set:function(e){this._bookingID=e}},{key:"fuelQuantity",get:function(){return this._fuelQuantity},set:function(e){this._fuelQuantity=e}},{key:"fuelPrice",get:function(){return this._fuelPrice},set:function(e){this._fuelPrice=e}},{key:"createdAt",get:function(){return this._createdAt},set:function(e){this._createdAt=e}},{key:"updatedAt",get:function(){return this._updatedAt},set:function(e){this._updatedAt=e}}]),e}(),Ne=a(75).extendMoment(q.a),we=a(103),Re=function(){var e=Object(n.useContext)(j),t=e.loading,a=e.notification,o=e.vehicles,i=e.addResource,c=Object(n.useState)(null),l=Object(D.a)(c,2),s=l[0],u=l[1],d=Object(n.useState)(!1),m=Object(D.a)(d,2),f=m[0],h=m[1],y=Object(C.g)().bookingID,g=Object(C.f)(),v=o.find((function(e){return e.bookings.some((function(e){return e.id===y}))})),E=we(v),b=E?E.bookings.find((function(e){return e.id===y})):null,p=we(b),k=oe.object().shape({fuelQuantity:oe.number().moreThan(0,"Invalid fuel quantity").max(E?E.tankCapacity:0,"Cannot be greater than the tank capacity of this vehicle").required("This field is required"),fuelPrice:oe.number().moreThan(0,"Invalid price").required("This field  is required")});return Object(n.useEffect)((function(){f&&s&&(i("fuel purchase",s),g.push("/show/".concat(E.id)))}),[f]),r.a.createElement(w.a,null,a&&a.display?r.a.createElement(B,{display:a.display,message:a.message}):"",r.a.createElement(R.a,null,r.a.createElement(T.a,null,r.a.createElement("h2",{className:"text-center my-5"},"Register new fuel purchase for ",E?"".concat(E.manufacturer," ").concat(E.model," (").concat(E.year,")"):"",", booked for: ",p?"".concat(Ne(p.startDate,"YYYY-MM-DD").format("DD/MM/YYYY")):""," - ",p?"".concat(Ne(p.endDate,"YYYY-MM-DD").format("DD/MM/YYYY")):""))),t?r.a.createElement(R.a,{className:"justify-content-center mt-5"},r.a.createElement(F,null)):r.a.createElement(re.a,{validationSchema:k,onSubmit:function(e){var t=e.fuelQuantity,a=e.fuelPrice,n=new _e(y,t,a);u(n),h(!0)},initialValues:{fuelQuantity:E?E.tankCapacity:"",fuelPrice:""}},(function(e){var t=e.handleSubmit,a=e.handleChange,n=e.resetForm,o=e.values,i=e.touched,c=e.errors,l=e.isSubmitting;return r.a.createElement(S.a,{onSubmit:t},r.a.createElement(S.a.Group,{as:R.a,controlId:"fuelQuantity"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Fuel quantity:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"fuelQuantity",value:o.fuelQuantity,type:"number",placeholder:"Fuel quantity (L)...",isValid:i.fuelQuantity&&!c.fuelQuantity,isInvalid:!!c.fuelQuantity}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.fuelQuantity))),r.a.createElement(S.a.Group,{as:R.a,controlId:"fuelPrice"},r.a.createElement(S.a.Label,{column:"true",sm:"2"},"Fuel price per litre:",r.a.createElement("span",{className:"text-danger"},"*")),r.a.createElement(T.a,{sm:"10"},r.a.createElement(S.a.Control,{onChange:a,name:"fuelPrice",value:o.fuelPrice,type:"number",placeholder:"Fuel price ($ / L)...",isValid:i.fuelPrice&&!c.fuelPrice,isInvalid:!!c.fuelPrice}),r.a.createElement(S.a.Control.Feedback,{type:"invalid"},c.fuelPrice))),r.a.createElement(R.a,{className:"justify-content-center my-5"},r.a.createElement(A.a,{variant:"primary",size:"lg",type:"submit",className:"mr-5",disabled:l},"Add fuel purchase"),r.a.createElement(A.a,{variant:"warning",size:"lg",className:"mr-5",onClick:n},"Clear"),r.a.createElement(A.a,{variant:"danger",size:"lg",onClick:function(){return g.push("/show/".concat(E.id))}},"Cancel")))})))},Te=function(e){var t,a,o,i,c,l=Object(C.f)(),s=Object(n.useContext)(j),u=s.vehicles,d=s.bookings,m=s.journeys,f=s.services,h=s.fuelPurchases,y=s.loading,g=s.notification;return(t=u.find((function(t){return t.id===e.match.params.vehicleID})))&&(a=d.filter((function(e){return e.vehicleID===t.id})),o=m.filter((function(e){return a.some((function(t){return t.id===e.bookingID}))})),i=f.filter((function(e){return e.vehicleID===t.id})),c=h.filter((function(e){return a.some((function(t){return t.id===e.bookingID}))}))),r.a.createElement(w.a,null,g.display?r.a.createElement(B,{display:g.display,message:g.message}):"",t?r.a.createElement(r.a.Fragment,null,r.a.createElement(R.a,null,r.a.createElement(T.a,null,r.a.createElement("h2",{className:"text-center my-5"},"".concat(t.manufacturer," ").concat(t.model," (").concat(t.year,")")))),y?r.a.createElement(R.a,{className:"justify-content-center mt-5"},r.a.createElement(F,null)):r.a.createElement(W,{vehicle:t,bookings:a,journeys:o,services:i,fuelPurchases:c})):r.a.createElement(r.a.Fragment,null,r.a.createElement(R.a,{className:"justify-content-center"},r.a.createElement(T.a,null,r.a.createElement("h2",{className:"text-center my-5"},"Sorry, no vehicles were found")))),r.a.createElement(R.a,{className:"my-5"},r.a.createElement(T.a,{className:"text-center"},r.a.createElement(A.a,{onClick:function(){return l.push("/browse")},variant:"primary",size:"lg"},"Browse vehicles"))))},Pe=function(e){return r.a.createElement("h1",{className:"display-5 text-center my-4"},e.headerText)},Fe=a(54),xe=function(e){return r.a.createElement(Fe.e,{width:"100%",height:300},r.a.createElement(Fe.b,{data:e.data},r.a.createElement(Fe.c,{stroke:"#ccc",strokeDasharray:"5 5"}),r.a.createElement(Fe.g,{dataKey:"monthAndYear"}),r.a.createElement(Fe.h,null),r.a.createElement(Fe.f,{content:r.a.createElement((function(e){var t=e.payload,a=e.label;return e.active&&t?r.a.createElement("div",{className:"bg-light text-dark text-center p-2 border border-dark"},r.a.createElement("p",{className:"font-weight-bold"},a),r.a.createElement("p",null,"Revenue: ",r.a.createElement("span",{className:"text-success"},"$ ".concat(Number.parseFloat(t[0].value).toFixed(2))))):null}),null)}),r.a.createElement(Fe.d,null),r.a.createElement(Fe.a,{dataKey:"revenue",barSize:20,fill:"#8884d8"})))},Be=function(e){var t=Object(n.useContext)(j),a=t.loading,o=t.revenue;return r.a.createElement(w.a,{className:"text-center"},r.a.createElement(Pe,{headerText:"Welcome to the Car Rental System"}),a?r.a.createElement(R.a,{className:"justify-content-center mt-5"},r.a.createElement(F,null)):r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",{className:"my-5 text-center"},"Revenue history (last 6 months):"),r.a.createElement(R.a,null,r.a.createElement(xe,{data:o}))),r.a.createElement(A.a,{size:"lg",variant:"primary",className:"mt-5",onClick:function(){return e.history.push("/browse")}},"Browse vehicles"))};function Le(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ve(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Le(a,!0).forEach((function(t){Object(u.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Le(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Je=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(h.a)(this,Object(y.a)(t).call(this,e))).fetchCollection=function(e){var t=e.trim().toLowerCase();return te.a.firestore().collection(e).get().then((function(n){var r=n.docs.map((function(e){return e.data()}));a.setState((function(a){return r=r.map((function(e){switch(t){case"vehicles":e=new ne(e._manufacturer,e._model,e._year,e._odometerReading,e._registrationNumber,e._tankCapacity,e._id,e._createdAt,e._updatedAt);break;case"bookings":e=new me(e._vehicleID,e._bookingType,e._startDate,e._endDate,e._startOdometer,e._id,e._createdAt,e._updatedAt);break;case"journeys":e=new je(e._bookingID,e._journeyStartOdometerReading,e._journeyEndOdometerReading,e._journeyStartedAt,e._journeyEndedAt,e._journeyFrom,e._journeyTo,e._id,e._createdAt,e._updatedAt);break;case"services":e=new Z(e._vehicleID,e._serviceOdometer,e._servicedAt,e._id,e._createdAt,e._updatedAt);break;case"fuelpurchases":case"fuel purchases":e=new _e(e._bookingID,e._fuelQuantity,e._fuelPrice,e._id,e._createdAt,e._updatedAt)}return e})),Object(u.a)({loading:!1},e,Object(d.a)(r))}),(function(){}))})).catch((function(e){a.setState({loading:!1},(function(){console.dir(e)}))}))},a.calculateTotalRevenue=function(e){var t=[];return(e=e||a.state.vehicles)&&e.length&&(e.forEach((function(e){var a,n=e.bookings.reduce((function(e,t){var a=t.bookingCost,n={bookingMonthAndYear:q()(t.startDate,"YYYY-MM-DD").format("MMMM YYYY"),bookingCost:a};return e.push(n),e}),[]).sort((function(e,t){return q()(e.bookingMonthAndYear,"MMMM YYYY").isSameOrBefore(q()(t.bookingMonthAndYear,"MMMM YYYY"))})).reduce((function(e,t){return e.some((function(e){return q()(e.monthAndYear,"MMMM YYYY").isSame(q()(t.bookingMonthAndYear,"MMMM YYYY"))}))?e[e.findIndex((function(e){return q()(e.monthAndYear,"MMMM YYYY").isSame(q()(t.bookingMonthAndYear,"MMMM YYYY"))}))].revenue+=t.bookingCost:e.push({monthAndYear:t.bookingMonthAndYear,revenue:t.bookingCost}),e}),[]);(a=t).push.apply(a,Object(d.a)(n))})),t=t.reduce((function(e,t){return e.some((function(e){return q()(e.monthAndYear,"MMMM YYYY").isSame(q()(t.monthAndYear,"MMMM YYYY"))}))?e[e.findIndex((function(e){return q()(e.monthAndYear,"MMMM YYYY").isSame(q()(t.monthAndYear,"MMMM YYYY"))}))].revenue+=t.revenue:e.push({monthAndYear:t.monthAndYear,revenue:t.revenue}),e}),[])),t.sort((function(e,t){return q()(e.monthAndYear,"MMMM YYYY").diff(q()(t.monthAndYear,"MMMM YYYY"))})).filter((function(e){return q()(e.monthAndYear,"MMMM YYYY").isSameOrBefore(q()(q()(),"MMMM YYYY"))})).filter((function(e){return q()(e.monthAndYear,"MMMM YYYY").isSameOrAfter(q()(q()(),"MMMM YYYY").subtract(6,"months"))}))},a.dismissNotification=function(){setTimeout((function(){a.setState({notification:{display:!1,message:""}})}),3500)},a.editVehicle=function(e){var t={};a.setState({loading:!0},(function(){a.setState((function(a){var n=Ve({},a).vehicles,r=n.findIndex((function(t){return t.id===e.id})),o=n[r];return t=Object.keys(o).reduce((function(t,a){return o[a]===e[a]||Array.isArray(e[a])||(t[a]=e[a]),t}),{}),n[r]=e,Ve({},a,{vehicles:n})}),(function(){return te.a.firestore().collection("vehicles").doc(e.id).update(t).then((function(){a.setState({loading:!1,notification:{display:!0,message:"The vehicle has been successfully updated"}},a.dismissNotification)})).catch((function(e){a.setState({loading:!1,notification:{display:!0,message:"Could not edit vehicle: ".concat(e)}},(function(){a.dismissNotification(),console.dir(e)}))}))}))}))},a.addResource=function(e,t){if(!e||!t)return a.setState({notification:{display:!0,message:"Error: missing resource or resource type"}},a.dismissNotification);var n,r,o,i;switch(e.trim().toLowerCase()){case"vehicle":n="vehicles";break;case"booking":n="bookings";break;case"service":n="services";break;case"journey":n="journeys";break;case"fuelpurchase":case"fuel purchase":n="fuelPurchases"}a.setState((function(e){if(!(r=n&&e[n]))return{notification:{display:!0,message:"Error: invalid resource type provided"}};var a=e.vehicles;switch(n){case"services":case"bookings":o=a.find((function(e){return e.id===t.vehicleID})),i=a.findIndex((function(e){return e.id===t.vehicleID})),"services"===n?o.addService(t):o.addBooking(t);break;case"journeys":case"fuelPurchases":o=a.find((function(e){return e.bookings.some((function(e){return e.id===t.bookingID}))})),i=a.findIndex((function(e){return e.bookings.some((function(e){return e.id===t.bookingID}))})),"journeys"===n?o.addJourney(t):o.addFuelPurchase(t);break;default:r.push(t)}return"vehicles"===n?{loading:!0,vehicles:r}:(e.vehicles[i]=o,{loading:!0,vehicles:Object(d.a)(e.vehicles)})}),(function(){n&&r?te.a.firestore().collection(n).doc(t.id).set(Ve({},t)).then((function(){a.setState((function(t){return{loading:!1,revenue:a.calculateTotalRevenue(t.vehicles),notification:{display:!0,message:"The new ".concat(e," has been successfully added to the system")}}}),a.dismissNotification)})).catch((function(t){a.setState({loading:!1,notification:{display:!0,message:"Could not add new ".concat(e,". Error: ").concat(t.message)}},a.dismissNotification)})):a.setState({notification:{display:!1,message:""}})}))},a.confirmDeleteResource=function(e,t){e&&t&&a.setDeleteResourceModalShow(null,null,(function(){a.setState((function(e){return Ve({},e,{loading:!0})}),(function(){var n;switch(e.trim().toLowerCase()){case"vehicle":n="vehicles";break;case"journey":n="journeys";break;case"service":n="services";break;case"booking":n="bookings";break;case"fuel purchase":case"fuelpurchase":n="fuelPurchases"}if(n){var r=te.a.firestore();"vehicles"===n?(t.bookings.forEach((function(e){e.journeys.forEach((function(e){r.collection("journeys").doc(e.id).delete()})),e.fuelPurchases.forEach((function(e){r.collection("fuelPurchases").doc(e.id).delete()})),r.collection("bookings").doc(e.id).delete()})),t.services.forEach((function(e){r.collection("services").doc(e.id).delete()})),r.collection("vehicles").doc(t.id).delete().then((function(){a.setState((function(n){var r=n.vehicles;return{vehicles:r=r.filter((function(e){return e.id!==t.id})),loading:!1,revenue:a.calculateTotalRevenue(r),notification:{display:!0,message:"The ".concat(e," has been successfully removed from the system")}}}),a.dismissNotification)}))):"bookings"===n?a.setState((function(e){var a=e.vehicles,n=a.find((function(e){return e.bookings.some((function(e){return e.id===t.id}))}));return n.removeBookingByID(t.id),{vehicles:[].concat(Object(d.a)(a.filter((function(e){return e.id!==n.id}))),[n])}}),(function(){r.collection("bookings").doc(t.id).delete().then((function(){a.setState((function(t){return{loading:!1,revenue:a.calculateTotalRevenue(t.vehicles),notification:{display:!0,message:"The ".concat(e," has been successfully removed from the system")}}}),a.dismissNotification)})).catch((function(e){a.state({loading:!1,notification:{display:!0,message:"Error: ".concat(e.message)}})}))})):"journeys"===n?a.setState((function(e){var a=e.vehicles,n=a.find((function(e){return e.bookings.some((function(e){return e.id===t.bookingID}))}));return n.removeJourneyByBookingID(t,t.bookingID),{vehicles:[].concat(Object(d.a)(a.filter((function(e){return e.id!==n.id}))),[n])}}),(function(){r.collection("journeys").doc(t.id).delete().then((function(){a.setState((function(t){return{loading:!1,revenue:a.calculateTotalRevenue(t.vehicles),notification:{display:!0,message:"The ".concat(e," has been successfully removed from the system")}}}),a.dismissNotification)}))})):"services"===n?a.setState((function(e){var a=e.vehicles,n=a.find((function(e){return e.id===t.vehicleID}));return n.removeServiceByID(t.id),{vehicles:[].concat(Object(d.a)(a.filter((function(e){return e.id!==n.id}))),[n])}}),(function(){r.collection("services").doc(t.id).delete().then((function(){a.setState({loading:!1,notification:{display:!0,message:"The ".concat(e," has been successfully removed from the system")}},a.dismissNotification)}))})):"fuelPurchases"===n?a.setState((function(e){var a=e.vehicles,n=a.find((function(e){return e.bookings.some((function(e){return e.id===t.bookingID}))}));return n.removeFuelPurchaseByBookingID(t,t.bookingID),{vehicles:[].concat(Object(d.a)(a.filter((function(e){return e.id!==n.id}))),[n])}}),(function(){r.collection("fuelPurchases").doc(t.id).delete().then((function(){a.setState({loading:!1,notification:{display:!0,message:"The ".concat(e," has been successfully removed from the system")}},a.dismissNotification)}))})):a.setState({loading:!1,notification:{display:!0,message:"Error: the collection associated with the item to be deleted was not found"}},a.dismissNotification)}}))}))},a.setDeleteResourceModalShow=function(e,t,n){a.setState((function(a){return{deleteResource:Ve({},a.deleteResource,{resource:t||a.deleteResource.resource,resourceType:e||a.deleteResource.resourceType,showDeleteResourceModal:!a.deleteResource.showDeleteResourceModal})}}),n)},a.state={loading:!0,vehicles:[],services:[],bookings:[],journeys:[],fuelPurchases:[],revenue:[],addVehicle:a.addVehicle,editVehicle:a.editVehicle,deleteResource:{resourceType:"",resource:"",confirmDeleteResource:a.confirmDeleteResource,showDeleteResourceModal:!1,setDeleteResourceModalShow:a.setDeleteResourceModalShow},addResource:a.addResource,addBooking:a.addBooking,addJourney:a.addJourney,addService:a.addService,addFuelPurchase:a.addFuelPurchase,notification:{display:!1,message:""}},a}return Object(g.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.fetchCollections("vehicles","bookings","journeys","services","fuelPurchases").then((function(t){e.setState((function(t){var a=t.services,n=t.bookings,r=t.journeys,o=t.fuelPurchases,i=t.vehicles;return i.forEach((function(e){n.filter((function(t){return t.vehicleID===e.id})).forEach((function(t){e.addBooking(t)}))})),i.forEach((function(e){r.filter((function(t){return e.bookings.some((function(e){return e.id===t.bookingID}))})).forEach((function(t){e.addJourney(t)})),o.filter((function(t){return e.bookings.some((function(e){return e.id===t.bookingID}))})).forEach((function(t){e.addFuelPurchase(t)})),a.filter((function(t){return t.vehicleID===e.id})).forEach((function(t){e.addService(t)}))})),i.forEach((function(t){t.updateVehicleOdometer((function(){e.setState({notification:{display:!0,message:"Updated odometer for ".concat(t.manufacturer," ").concat(t.model," (").concat(t.year,")")}},e.dismissNotification)}))})),{vehicles:i,revenue:e.calculateTotalRevenue(i)}}))})).catch((function(t){e.setState({notification:{display:!0,message:"Error: ".concat(t.message)}},e.dismissNotification)}))}},{key:"fetchCollections",value:function(){var e=Object(s.a)(l.a.mark((function e(){var t,a,n,r=this,o=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=o.length,a=new Array(t),n=0;n<t;n++)a[n]=o[n];return e.abrupt("return",Promise.all(a.map((function(e){return r.fetchCollection(e)}))));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement(O,{value:this.state},r.a.createElement(N,null),r.a.createElement(C.c,null,r.a.createElement(C.a,{exact:!0,path:"/",render:function(e){return r.a.createElement(Be,e)}}),r.a.createElement(C.a,{path:"/browse"},r.a.createElement(X,null)),r.a.createElement(C.a,{path:"/add",render:function(e){return r.a.createElement(le,e)}}),r.a.createElement(C.a,{path:"/show/:vehicleID",render:function(e){return r.a.createElement(Te,e)}}),r.a.createElement(C.a,{path:"/edit/:vehicleID",render:function(e){return r.a.createElement(ue,e)}}),r.a.createElement(C.a,{path:"/addBooking/:vehicleID",render:function(e){return r.a.createElement(ge,e)}}),r.a.createElement(C.a,{path:"/addJourney/:vehicleID",render:function(e){return r.a.createElement(Ye,e)}}),r.a.createElement(C.a,{path:"/addJourneyForm/:bookingID",render:function(e){return r.a.createElement(Se,e)}}),r.a.createElement(C.a,{path:"/addService/:vehicleID",render:function(e){return r.a.createElement(be,e)}}),r.a.createElement(C.a,{path:"/addFuelPurchase/:vehicleID",render:function(e){return r.a.createElement(Ce,e)}}),r.a.createElement(C.a,{path:"/addFuelPurchaseForm/:bookingID",render:function(e){return r.a.createElement(Re,e)}}),r.a.createElement(C.a,{path:"*",render:function(e){return r.a.createElement(X,e)}})))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(640),a(641);i.a.render(r.a.createElement(p.a,null,r.a.createElement(Je,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[342,1,2]]]);
//# sourceMappingURL=main.e1134252.chunk.js.map